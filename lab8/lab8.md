1. какие базовые цепочки и таблицы существуют в iptables и для чего служат?
 - Цепочки:
   - PREROUTING — пакеты до маршрутизации
   - INPUT — пакеты, для текущего хоста
   - FORWARD — транзитные пакеты
   - OUTPUT — пакеты от текущего хоста
   - POSTROUTING — все исходящие пакеты 
 - Таблицы:
   - MANGLE — классификация и маркировка пакетов и соединений, модификация заголовков
   - NAT — преобразование сетевых адресов и портов
   - FILTER — фильтрация трафика
   - SECURITY — изменение маркировок безопасности
   - RAW — действия с пакетами до обработки conntrack
   - RAWPOST — подмена исходного трафика без использования информации о соединении
2. опишите процесс обработки пакета который предназначен данной системе
 - PREROUTING -> INPUT -> LOCAL PROCESS -> OUTPUT -> POSTROUTING
3. что такое conntrack и для чего используется?
 - Отслеживает все логические сетевые соединения, чтобы идентифицировать пакеты из одного потока для дальнейшего использования их вместе
4. какими командами создать/удалить цепочку? создать/удалить правило? создать правило до определенного правила в цепочке?
 - Создать цепочку: iptables -N NEWCHAIN
 - Удалить цепочку: iptables -X NEWCHAIN
 - Создать правило: iptables -A NEWCHAIN [arguments]
 -  До определенного(N): iptables -I NEWCHAIN [N] [arguments]
 - Удалить правило: iptables -D NEWCHAIN

Практика  
взять за основу конфигурационный файл iptables, поднять в системе ssh сервер.   

 iptables-restore chelgu_iptables  
 systemctl start ssh  
1. настроить правила которые разрешают доступ на этот сервер с определенной подсети или хоста в которой находитесь вы как клиент, продемонстрировать что работает icmp

 iptables -I INPUT -s 192.168.174.1 -j ACCEPT  
 
![](1.png)  

2. затем закрыть доступ из этой подсети по icmp, осавив доступ по ssh, продемонстрировать что хост по ssh доступен а icmp нет  
 iptables -I INPUT -s 192.168.174.1 -j DROP  
 iptables -I INPUT -s 192.168.174.1 -p tcp --dport 22 -j ACCEPT  
![](2.1.png)  
![](2.2.png)  

3. Запретить только ssh , продемонстрировать что icmp работает
 iptables -I INPUT -s 192.168.174.1 -p tcp --dport 22 -j DROP  
![](3.1.png)  
![](3.2.png)
